"""
Schema GraphQL para el subgraph del DApp Store
"""

type App @entity(immutable: false) {
  id: ID! # slug
  publisher: Publisher!
  slug: String!
  name: String!
  latestManifestCid: String!
  latestVersion: AppVersion
  totalDownloads: BigInt!
  active: Boolean!
  createdAt: BigInt!
  updatedAt: BigInt!
  versions: [AppVersion!]! @derivedFrom(field: "app")
  downloads: [Download!]! @derivedFrom(field: "app")
}

type AppVersion @entity(immutable: false) {
  id: ID! # slug-versionCode
  app: App!
  versionCode: Int!
  manifestCid: String!
  publishedAt: BigInt!
  publishedBy: Bytes!
  deprecated: Boolean!
}

type Publisher @entity(immutable: false) {
  id: ID! # address
  address: Bytes!
  apps: [App!]! @derivedFrom(field: "publisher")
  totalApps: BigInt!
  totalDownloads: BigInt!
  createdAt: BigInt!
}

type User @entity(immutable: false) {
  id: ID! # address
  address: Bytes!
  downloads: [Download!]! @derivedFrom(field: "user")
  totalDownloads: BigInt!
  createdAt: BigInt!
}

type Download @entity(immutable: true) {
  id: ID! # txHash-logIndex
  app: App!
  user: User!
  timestamp: BigInt!
  transactionHash: Bytes!
}

type GlobalStats @entity(immutable: false) {
  id: ID! # "global"
  totalApps: BigInt!
  totalPublishers: BigInt!
  totalUsers: BigInt!
  totalDownloads: BigInt!
  updatedAt: BigInt!
}
